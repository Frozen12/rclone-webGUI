<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rclone WebGUI</title>
    <script>
        // Apply saved theme immediately to prevent flash
        const savedTheme = localStorage.getItem('theme') || 'dark-mode';
        document.documentElement.className = savedTheme; // Apply to html tag for full page theme
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" href="{{ url_for('static', filename='favicon.svg') }}" type="image/svg+xml">
</head>
<body class="flex flex-col min-h-screen">
    <header class="bg-card-bg-color p-4 shadow-md flex flex-wrap justify-between items-center rounded-b-xl sticky top-0 z-10 border-b border-border-color">
        <div class="flex items-center">
            <svg class="h-8 w-8 text-accent-color mr-3" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"/>
                <path d="M11 9.5L7 11v-1.5L11 8z" fill="#DCE7DC"/>
                <path d="M11 14.5l-4 2.5v-1.5l4-2.5z" fill="#DCE7DC"/>
                <path d="M16 11l-4 2.5v-1.5l4-2.5z" fill="#558B55"/>
                <path d="M16 14.5l-4 2.5v-1.5l4-2.5z" fill="#558B55"/>
            </svg>
            <h1 class="text-4xl font-bold app-title">Rclone WebGUI</h1>
        </div>
        <div class="flex items-center space-x-4 mt-2 md:mt-0">
            <div class="relative">
                <button id="theme-switcher-btn" class="btn-secondary p-2 rounded-lg flex items-center">
                    <i class="fas fa-palette mr-2"></i> Theme
                </button>
                <div id="theme-switcher-dropdown" class="absolute right-0 mt-2 w-48 bg-card-bg-color rounded-xl shadow-lg py-2 z-20 hidden border border-border-color">
                    <a href="#" class="block px-4 py-2 text-text-color hover:bg-input-bg-color theme-option" data-theme="dark-mode">Dark Green (Default)</a>
                    <a href="#" class="block px-4 py-2 text-text-color hover:bg-input-bg-color theme-option" data-theme="blue-mode">Blue</a>
                    <a href="#" class="block px-4 py-2 text-text-color hover:bg-input-bg-color theme-option" data-theme="purple-mode">Purple</a>
                    <a href="#" class="block px-4 py-2 text-text-color hover:bg-input-bg-color theme-option" data-theme="orange-mode">Orange</a>
                    <a href="#" class="block px-4 py-2 text-text-color hover:bg-input-bg-color theme-option" data-theme="red-mode">Red</a>
                    <a href="#" class="block px-4 py-2 text-text-color hover:bg-input-bg-color theme-option" data-theme="teal-mode">Teal</a>
                    <a href="#" class="block px-4 py-2 text-text-color hover:bg-input-bg-color theme-option" data-theme="indigo-mode">Indigo</a>
                </div>
            </div>
            <a href="/logout" class="logout-button btn-danger p-2 rounded-lg font-semibold text-sm">
                <i class="fas fa-sign-out-alt mr-2"></i> Logout
            </a>
        </div>
    </header>

    <main class="flex flex-1 flex-col md:flex-row p-4 space-y-4 md:space-y-0 md:space-x-4">
        <aside class="w-full md:w-64 bg-card-bg-color p-4 rounded-xl shadow-md flex-shrink-0">
            <nav>
                <ul class="space-y-3">
                    <li><button class="nav-button w-full flex items-center p-3 rounded-lg text-left text-text-color hover:bg-input-bg-color focus:outline-none focus:ring-2 focus:ring-accent-color active-nav-button" data-target="setup-section"><i class="fas fa-cog mr-3"></i> Setup</button></li>
                    <li><button class="nav-button w-full flex items-center p-3 rounded-lg text-left text-text-color hover:bg-input-bg-color focus:outline-none focus:ring-2 focus:ring-accent-color" data-target="rclone-transfer-section"><i class="fas fa-exchange-alt mr-3"></i> Rclone Transfer</button></li>
                    <li><button class="nav-button w-full flex items-center p-3 rounded-lg text-left text-text-color hover:bg-input-bg-color focus:outline-none focus:ring-2 focus:ring-accent-color" data-target="web-terminal-section"><i class="fas fa-terminal mr-3"></i> Web Terminal</button></li>
                    <li><button class="nav-button w-full flex items-center p-3 rounded-lg text-left text-text-color hover:bg-input-bg-color focus:outline-none focus:ring-2 focus:ring-accent-color" data-target="recent-commands-section"><i class="fas fa-history mr-3"></i> Recent Commands</button></li>
                    <li><button class="nav-button w-full flex items-center p-3 rounded-lg text-left text-text-color hover:bg-input-bg-color focus:outline-none focus:ring-2 focus:ring-accent-color" data-target="notepad-section"><i class="fas fa-clipboard mr-3"></i> Notepad</button></li>
                </ul>
            </nav>
        </aside>

        <section class="flex-1 bg-card-bg-color p-6 rounded-xl shadow-md">

            <div id="setup-section" class="content-section fade-in">
                <h2 class="text-2xl font-bold mb-4 text-primary-color flex items-center"><i class="fas fa-cog mr-3"></i> Setup Rclone Configuration & Service Accounts</h2>

                <div class="mb-6 p-4 border border-border-color rounded-lg bg-input-bg-color">
                    <h3 class="text-xl font-semibold mb-3 text-accent-color">Upload rclone.conf</h3>
                    <p class="text-text-color mb-3">Upload your `rclone.conf` file to configure remotes. This will overwrite any existing configuration.</p>
                    <div class="flex flex-col md:flex-row items-stretch md:items-center space-y-3 md:space-y-0 md:space-x-3">
                        <label for="rclone_conf_upload" class="custom-file-upload btn-secondary flex-1 text-center py-2 px-4 rounded-lg cursor-pointer">
                            <i class="fas fa-upload mr-2"></i> Choose rclone.conf
                        </label>
                        <input type="file" id="rclone_conf_upload" class="hidden" accept=".conf">
                        <button id="upload_rclone_conf_btn" class="btn-primary flex-1 py-2 px-4 rounded-lg">Upload Config</button>
                    </div>
                    <p id="rclone_conf_status" class="mt-3 text-sm text-center text-info-color"></p>
                </div>

                <div class="mb-6 p-4 border border-border-color rounded-lg bg-input-bg-color">
                    <h3 class="text-xl font-semibold mb-3 text-accent-color">Upload Service Account JSONs (ZIP)</h3>
                    <p class="text-text-color mb-3">Upload a `.zip` file containing your Google Drive Service Account JSON keys. Existing JSON files will be cleared before extraction.</p>
                    <div class="flex flex-col md:flex-row items-stretch md:items-center space-y-3 md:space-y-0 md:space-x-3">
                        <label for="sa_zip_upload" class="custom-file-upload btn-secondary flex-1 text-center py-2 px-4 rounded-lg cursor-pointer">
                            <i class="fas fa-file-archive mr-2"></i> Choose SA ZIP
                        </label>
                        <input type="file" id="sa_zip_upload" class="hidden" accept=".zip">
                        <button id="upload_sa_zip_btn" class="btn-primary flex-1 py-2 px-4 rounded-lg">Upload SA ZIP</button>
                    </div>
                    <p id="sa_zip_status" class="mt-3 text-sm text-center text-info-color"></p>
                </div>

                <div class="p-4 border border-border-color rounded-lg bg-input-bg-color">
                    <h3 class="text-xl font-semibold mb-3 text-accent-color">Configuration Storage</h3>
                    <p class="text-text-color">Your `rclone.conf` and Service Account JSONs are stored in the `/app/.config/rclone/` directory within the container. Note that on platforms like Render, this might be ephemeral storage and could reset on new deployments or container restarts, unless persistent storage is configured for the `/app/.config` directory.</p>
                </div>
            </div>

            <div id="rclone-transfer-section" class="content-section fade-out">
                <h2 class="text-2xl font-bold mb-4 text-primary-color flex items-center"><i class="fas fa-exchange-alt mr-3"></i> Rclone Transfer</h2>

                <form id="rclone-transfer-form" class="space-y-4">
                    <div class="form-group">
                        <label for="mode" class="block text-sm font-bold mb-2 text-primary-color">Rclone Mode</label>
                        <select id="mode" name="mode" class="input-field w-full p-3 rounded-lg focus:ring-2 focus:ring-accent-color focus:border-transparent outline-none">
                            <option value="">Select Mode</option>
                            <optgroup label="Two-Remote Operations">
                                <option value="sync">Sync (Source to Dest)</option>
                                <option value="copy">Copy (Source to Dest)</option>
                                <option value="move">Move (Source to Dest)</option>
                                <option value="copyurl">Copy URL</option>
                                <option value="check">Check</option>
                                <option value="cryptcheck">Cryptcheck</option>
                            </optgroup>
                            <optgroup label="One-Remote Operations">
                                <option value="lsd">List Directories</option>
                                <option value="ls">List Files</option>
                                <option value="tree">Tree View</option>
                                <option value="listremotes">List Remotes</option>
                                <option value="mkdir">Make Directory</option>
                                <option value="size">Calculate Size</option>
                                <option value="serve">Serve</option>
                                <option value="dedupe">Deduplicate</option>
                                <option value="cleanup">Cleanup</option>
                                <option value="delete">Delete Files</option>
                                <option value="deletefile">Delete Single File</option>
                                <option value="purge">Purge Directory</option>
                                <option value="version">Show Version</option>
                            </optgroup>
                        </select>
                        <p id="mode-description" class="text-sm text-info-color mt-2">Select an Rclone command mode.</p>
                    </div>

                    <div id="url-field" class="form-group mb-4" style="display: none;">
                        <label for="url" class="block text-sm font-bold mb-2 text-primary-color">URL</label>
                        <input type="text" id="url" name="url"
                               class="input-field w-full p-3 rounded-lg focus:ring-2 focus:ring-accent-color focus:border-transparent outline-none"
                               placeholder="Enter URL for copyurl mode (e.g., https://example.com/file.zip)">
                    </div>

                    <div id="serve-protocol-field" class="form-group mb-4" style="display: none;">
                        <label for="serve_protocol" class="block text-sm font-bold mb-2 text-primary-color">Serve Protocol</label>
                        <select id="serve_protocol" name="serve_protocol" class="input-field w-full p-3 rounded-lg">
                            <option value="">Select Protocol</option>
                            <option value="http">HTTP</option>
                            <option value="webdav">WebDAV</option>
                            <option value="ftp">FTP</option>
                            <option value="sftp">SFTP</option>
                            <option value="dlna">DLNA</option>
                            <option value="webgui">WebGUI</option>
                        </select>
                    </div>

                    <div id="source-and-destination-fields">
                        <div id="source-field" class="form-group mb-4">
                            <label for="source" class="block text-sm font-bold mb-2 text-primary-color">Source:</label>
                            <input type="text" id="source" name="source" required
                                   class="input-field w-full p-3 rounded-lg focus:ring-2 focus:ring-accent-color focus:border-transparent outline-none"
                                   placeholder="e.g., remote:path/to/source or /local/path">
                        </div>

                        <div id="destination-field" class="form-group mb-4">
                            <label for="destination" class="block text-sm font-bold mb-2 text-primary-color">Destination:</label>
                            <input type="text" id="destination" name="destination"
                                   class="input-field w-full p-3 rounded-lg focus:ring-2 focus:ring-accent-color focus:border-transparent outline-none"
                                   placeholder="e.g., remote:path/to/destination">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="transfers" class="block text-sm font-bold mb-2 text-primary-color">Transfers (--transfers)</label>
                        <input type="range" id="transfers" name="transfers" min="1" max="16" value="4"
                               class="w-full h-2 bg-input-bg-color rounded-lg appearance-none cursor-pointer range-lg">
                        <span id="transfers-value" class="block text-center text-text-color">4</span>
                    </div>

                    <div class="form-group">
                        <label for="checkers" class="block text-sm font-bold mb-2 text-primary-color">Checkers (--checkers)</label>
                        <input type="range" id="checkers" name="checkers" min="1" max="16" value="8"
                               class="w-full h-2 bg-input-bg-color rounded-lg appearance-none cursor-pointer range-lg">
                        <span id="checkers-value" class="block text-center text-text-color">8</span>
                    </div>

                    <div class="form-group">
                        <label for="buffer_size" class="block text-sm font-bold mb-2 text-primary-color">Buffer Size (--buffer-size & --drive-chunk-size)</label>
                        <select id="buffer_size" name="buffer_size" class="input-field w-full p-3 rounded-lg">
                            <option value="">Default</option>
                            <option value="16M">16M</option>
                            <option value="32M">32M</option>
                            <option value="64M">64M</option>
                            <option value="128M">128M</option>
                            <option value="256M">256M</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="order" class="block text-sm font-bold mb-2 text-primary-color">Order By (--order-by)</label>
                        <select id="order" name="order" class="input-field w-full p-3 rounded-lg">
                            <option value="">Default</option>
                            <option value="name">Name</option>
                            <option value="size">Size</option>
                            <option value="modtime">Modification Time</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="loglevel" class="block text-sm font-bold mb-2 text-primary-color">Log Level (--log-level)</label>
                        <select id="loglevel" name="loglevel" class="input-field w-full p-3 rounded-lg">
                            <option value="INFO">INFO (Default)</option>
                            <option value="ERROR">ERROR</option>
                            <option value="DEBUG">DEBUG</option>
                        </select>
                    </div>

                    <div class="form-group flex items-center space-x-3">
                        <input type="checkbox" id="use_drive_trash" name="use_drive_trash" class="form-checkbox h-5 w-5 text-accent-color rounded">
                        <label for="use_drive_trash" class="text-text-color">Use Drive Trash (--drive-use-trash)</label>
                    </div>

                    <div class="form-group flex items-center space-x-3">
                        <input type="checkbox" id="service_account" name="service_account" class="form-checkbox h-5 w-5 text-accent-color rounded">
                        <label for="service_account" class="text-text-color">Use Service Account (--drive-service-account-directory)</label>
                    </div>

                    <div class="form-group flex items-center space-x-3">
                        <input type="checkbox" id="dry_run" name="dry_run" class="form-checkbox h-5 w-5 text-accent-color rounded">
                        <label for="dry_run" class="text-text-color">Dry Run (--dry-run)</label>
                    </div>

                    <div class="form-group">
                        <label for="additional_flags" class="block text-sm font-bold mb-2 text-primary-color">Additional Flags (e.g., --delete-empty-dirs)</label>
                        <input type="text" id="additional_flags" name="additional_flags"
                               class="input-field w-full p-3 rounded-lg focus:ring-2 focus:ring-accent-color focus:border-transparent outline-none"
                               placeholder="Enter any extra rclone flags">
                    </div>

                    <div class="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3">
                        <button type="submit" id="executeRcloneBtn" class="btn-primary flex-1 p-3 rounded-lg font-semibold text-lg hover:shadow-md">
                            <i class="fas fa-play-circle mr-2"></i> Execute Rclone
                        </button>
                        <button type="button" id="stopRcloneBtn" class="btn-danger flex-1 p-3 rounded-lg font-semibold text-lg hover:shadow-md hidden">
                            <i class="fas fa-stop-circle mr-2"></i> Stop Rclone
                        </button>
                    </div>
                </form>

                <div class="rclone-output mt-6 p-4 bg-input-bg-color rounded-lg border border-border-color">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-xl font-semibold text-accent-color">Output</h3>
                        <div>
                            <button id="clearOutputBtn" class="btn-secondary px-3 py-1 text-sm rounded-lg mr-2"><i class="fas fa-eraser mr-2"></i> Clear Output</button>
                            <button id="downloadLogsBtn" class="btn-secondary px-3 py-1 text-sm rounded-lg"><i class="fas fa-download mr-2"></i> Download Log</button>
                        </div>
                    </div>
                    <pre id="rclone-output-area" class="whitespace-pre-wrap font-mono text-sm text-text-color h-80 overflow-auto bg-gray-900 p-3 rounded-md"></pre>
                    <p id="rclone-status-message" class="mt-3 text-center font-bold"></p>
                </div>
            </div>

            <div id="web-terminal-section" class="content-section fade-out">
                <h2 class="text-2xl font-bold mb-4 text-primary-color flex items-center"><i class="fas fa-terminal mr-3"></i> Web Terminal</h2>
                <div class="mb-4">
                    <input type="text" id="terminalCommandInput"
                           class="input-field w-full p-3 rounded-lg focus:ring-2 focus:ring-accent-color focus:border-transparent outline-none"
                           placeholder="Enter command (e.g., ls -la, df -h)">
                </div>
                <div class="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3">
                    <button id="executeTerminalBtn" class="btn-primary flex-1 p-3 rounded-lg font-semibold text-lg hover:shadow-md">
                        <i class="fas fa-play-circle mr-2"></i> Execute Command
                    </button>
                    <button id="stopTerminalBtn" class="btn-danger flex-1 p-3 rounded-lg font-semibold text-lg hover:shadow-md hidden">
                        <i class="fas fa-stop-circle mr-2"></i> Stop Command
                    </button>
                </div>
                <div class="terminal-output mt-6 p-4 bg-input-bg-color rounded-lg border border-border-color">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-xl font-semibold text-accent-color">Terminal Output</h3>
                        <div>
                            <button id="clearTerminalOutputBtn" class="btn-secondary px-3 py-1 text-sm rounded-lg mr-2"><i class="fas fa-eraser mr-2"></i> Clear Output</button>
                            <button id="downloadTerminalLogBtn" class="btn-secondary px-3 py-1 text-sm rounded-lg"><i class="fas fa-download mr-2"></i> Download Terminal Log</button>
                        </div>
                    </div>
                    <pre id="terminal-output-area" class="whitespace-pre-wrap font-mono text-sm text-text-color h-80 overflow-auto bg-gray-900 p-3 rounded-md"></pre>
                    <p id="terminal-status-message" class="mt-3 text-center font-bold"></p>
                    <div id="terminal-spinner" class="spinner hidden mt-4"></div>
                </div>
            </div>

            <div id="recent-commands-section" class="content-section fade-out">
                <h2 class="text-2xl font-bold mb-4 text-primary-color flex items-center"><i class="fas fa-history mr-3"></i> Recent Commands</h2>
                <div id="recent-commands-list" class="space-y-4">
                    <p class="text-text-color">No recent commands. Commands executed in the Web Terminal will appear here.</p>
                </div>
            </div>

            <div id="notepad-section" class="content-section fade-out">
                <h2 class="text-2xl font-bold mb-4 text-primary-color flex items-center"><i class="fas fa-clipboard mr-3"></i> Notepad</h2>
                <textarea id="notepad-content" class="input-field w-full p-4 rounded-lg min-h-[400px]" placeholder="Type or paste your notes here. This content will be saved automatically in your browser."></textarea>
            </div>

        </section>
    </main>

    <div id="terminalConfirmModal" class="modal hidden">
        <div class="modal-content card rounded-xl p-8 shadow-2xl">
            <h2 class="text-2xl font-bold mb-4 text-primary-color">Process Running</h2>
            <p class="text-text-color mb-6" id="terminalConfirmMessage">A command is currently running: <code class="bg-input-bg-color p-1 rounded"></code>. Do you want to stop it and start a new one?</p>
            <div class="flex justify-end space-x-4">
                <button id="confirmStopAndStartBtn" class="btn-danger"><i class="fas fa-stop mr-2"></i> Stop and Start New</button>
                <button id="cancelStopAndStartBtn" class="btn-secondary"><i class="fas fa-times-circle mr-2"></i> Cancel</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
