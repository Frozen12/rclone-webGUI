<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rclone WebGUI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" href="{{ url_for('static', filename='favicon.svg') }}" type="image/svg+xml">
    <script>
        // Immediately apply the theme from localStorage to prevent FOUC
        (function() {
            const theme = localStorage.getItem('theme') || 'theme-green-dark'; // Default theme
            document.documentElement.className = theme;
        })();
    </script>
</head>
<body class="bg-bg-color flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-card-bg-color p-4 shadow-md flex justify-between items-center rounded-b-xl sticky top-0 z-20 border-b border-border-color">
        <h1 class="main-title">Rclone WebGUI</h1>
        <div class="flex items-center space-x-2 sm:space-x-4">
            <div class="relative">
                <select id="theme-selector" class="input-field appearance-none rounded-lg p-2 pr-8 focus:ring-2 focus:ring-accent-color outline-none cursor-pointer">
                    <optgroup label="Dark Themes">
                        <option value="theme-green-dark">Green (Default)</option>
                        <option value="theme-blue-dark">Blue</option>
                        <option value="theme-purple-dark">Purple</option>
                    </optgroup>
                    <optgroup label="Light Themes">
                        <option value="theme-green-light">Green Light</option>
                        <option value="theme-blue-light">Blue Light</option>
                        <option value="theme-purple-light">Purple Light</option>
                    </optgroup>
                </select>
                <i class="fas fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-text-color/50 pointer-events-none"></i>
            </div>
            <button id="logout-btn" class="btn-secondary logout-btn"><i class="fas fa-sign-out-alt"></i><span class="hidden sm:inline ml-2">Logout</span></button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto p-4 sm:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
        <!-- Sidebar Navigation -->
        <aside class="lg:col-span-3">
            <div class="card p-4 rounded-xl shadow-md sticky top-24">
                <nav class="flex flex-row lg:flex-col gap-2">
                    <button class="nav-button active" data-target="rclone-transfer-section"><i class="fas fa-exchange-alt mr-3 w-5 text-center"></i><span class="flex-1 text-left">Rclone Transfer</span></button>
                    <button class="nav-button" data-target="setup-section"><i class="fas fa-cogs mr-3 w-5 text-center"></i><span class="flex-1 text-left">Setup</span></button>
                    <button class="nav-button" data-target="web-terminal-section"><i class="fas fa-terminal mr-3 w-5 text-center"></i><span class="flex-1 text-left">Web Terminal</span></button>
                    <button class="nav-button" data-target="recent-commands-section"><i class="fas fa-history mr-3 w-5 text-center"></i><span class="flex-1 text-left">Recent</span></button>
                </nav>
            </div>
        </aside>

        <!-- Content Sections -->
        <section class="lg:col-span-9 space-y-6">
            <!-- Major Steps Output -->
            <div id="majorStepsOutput" class="p-4 rounded-xl shadow-md text-center font-semibold hidden"></div>

            <!-- Rclone Transfer Section -->
            <div id="rclone-transfer-section" class="content-section card p-6 rounded-xl shadow-md">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Column 1: Main Controls -->
                    <div class="space-y-4">
                        <div>
                            <label for="mode" class="label">Rclone Mode</label>
                            <select id="mode" class="input-field">
                                <optgroup label="Two-Remote Commands">
                                    <option value="sync">sync</option>
                                    <option value="copy">copy</option>
                                    <option value="move">move</option>
                                    <option value="copyurl">copyurl</option>
                                    <option value="check">check</option>
                                    <option value="cryptcheck">cryptcheck</option>
                                </optgroup>
                                <optgroup label="One-Remote Commands">
                                    <option value="lsd">lsd</option>
                                    <option value="ls">ls</option>
                                    <option value="tree">tree</option>
                                    <option value="listremotes">listremotes</option>
                                    <option value="mkdir">mkdir</option>
                                    <option value="size">size</option>
                                    <option value="serve">serve</option>
                                    <option value="dedupe">dedupe</option>
                                    <option value="cleanup">cleanup</option>
                                    <option value="delete">delete</option>
                                    <option value="deletefile">deletefile</option>
                                    <option value="purge">purge</option>
                                    <option value="version">version</option>
                                </optgroup>
                            </select>
                            <p id="mode-description" class="text-sm text-text-color/70 mt-2"></p>
                        </div>
                        
                        <!-- Special field for copyurl -->
                        <div id="copy-url-field" class="hidden">
                             <label for="url-input" class="label">URL to Copy</label>
                             <input type="text" id="url-input" class="input-field" placeholder="https://example.com/file.zip">
                        </div>

                        <!-- Special fields for serve -->
                        <div id="serve-protocol-field" class="hidden">
                            <label for="serve-protocol-input" class="label">Serve Protocol</label>
                            <select id="serve-protocol-input" class="input-field">
                                <option value="http">http</option>
                                <option value="webdav">webdav</option>
                                <option value="ftp">ftp</option>
                                <option value="sftp">sftp</option>
                                <option value="dlna">dlna</option>
                            </select>
                        </div>

                        <div id="source-field">
                            <label for="source" class="label">Source</label>
                            <input type="text" id="source" class="input-field" placeholder="remote:path/to/source">
                        </div>
                        <div id="destination-field">
                            <label for="destination" class="label">Destination</label>
                            <input type="text" id="destination" class="input-field" placeholder="remote:path/to/destination">
                        </div>
                        <div>
                            <label for="additional_flags" class="label">Additional Flags</label>
                            <input type="text" id="additional_flags" class="input-field" value="--azureblob-env-auth --crypt-pass-bad-blocks">
                        </div>
                    </div>

                    <!-- Column 2: Parameters & Flags -->
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="transfers" class="label">Transfers: <span id="transfers-value">4</span></label>
                                <input id="transfers" type="range" min="1" max="20" value="4" class="w-full h-2 bg-input-bg-color rounded-lg appearance-none cursor-pointer">
                            </div>
                            <div>
                                <label for="checkers" class="label">Checkers: <span id="checkers-value">8</span></label>
                                <input id="checkers" type="range" min="1" max="20" value="8" class="w-full h-2 bg-input-bg-color rounded-lg appearance-none cursor-pointer">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                             <div>
                                <label for="buffer_size" class="label">Buffer Size</label>
                                <select id="buffer_size" class="input-field">
                                    <option>2M</option><option>4M</option><option>8M</option><option selected>16M</option><option>32M</option><option>64M</option><option>128M</option><option>256M</option>
                                </select>
                            </div>
                             <div>
                                <label for="order" class="label">Order By</label>
                                <select id="order" class="input-field">
                                    <option>size,ascending</option><option>size,descending</option><option>size,mixed,75</option><option selected>size,mixed,50</option><option>size,mixed,25</option><option>size,mixed,10</option>
                                </select>
                            </div>
                        </div>
                         <div>
                            <label for="loglevel" class="label">Log Level</label>
                            <select id="loglevel" class="input-field">
                                <option>ERROR</option><option selected>INFO</option><option>DEBUG</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-6 pt-2">
                            <label class="flex items-center cursor-pointer"><input type="checkbox" id="use_drive_trash" class="checkbox"> <span class="ml-2">Use Drive Trash</span></label>
                            <label class="flex items-center cursor-pointer"><input type="checkbox" id="service_account" class="checkbox"> <span class="ml-2">Use SA</span></label>
                            <label class="flex items-center cursor-pointer"><input type="checkbox" id="dry_run" class="checkbox"> <span class="ml-2">Dry Run</span></label>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-wrap gap-4 mt-6">
                    <button id="startRcloneTransferBtn" class="btn-primary flex-grow"><i class="fas fa-play mr-2"></i> Start Transfer</button>
                    <button id="stopRcloneTransferBtn" class="btn-danger flex-grow hidden"><i class="fas fa-stop mr-2"></i> Stop Transfer</button>
                    <button id="downloadRcloneLogBtn" class="btn-secondary"><i class="fas fa-download mr-2"></i> Log</button>
                    <button id="clearRcloneOutputBtn" class="btn-secondary"><i class="fas fa-broom mr-2"></i> Clear</button>
                </div>

                <!-- Rclone Live Output -->
                <div class="mt-6 relative">
                    <div id="rclone-spinner" class="spinner-overlay hidden">
                        <div class="spinner"></div>
                        <p id="rclone-spinner-text" class="spinner-text">Transferring...</p>
                    </div>
                    <pre id="rcloneLiveOutput" class="output-area"></pre>
                </div>
            </div>

            <!-- Setup Section -->
            <div id="setup-section" class="content-section card p-6 rounded-xl shadow-md hidden">
                <h2 class="text-2xl font-bold mb-4 text-primary-color flex items-center"><i class="fas fa-cogs mr-3"></i> Setup</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label for="rclone-conf-upload" class="label">Rclone Config (rclone.conf)</label>
                        <div class="flex gap-2">
                             <input type="file" id="rclone-conf-upload" class="input-field file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-accent-color/20 file:text-accent-color hover:file:bg-accent-color/30 flex-grow" accept=".conf">
                             <button id="uploadRcloneConfBtn" class="btn-primary">Upload</button>
                        </div>
                        <p class="text-sm text-text-color/70">Upload your rclone configuration file.</p>
                    </div>
                    <div class="space-y-2">
                        <label for="sa-zip-upload" class="label">Service Accounts (sa-accounts.zip)</label>
                         <div class="flex gap-2">
                            <input type="file" id="sa-zip-upload" class="input-field file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-accent-color/20 file:text-accent-color hover:file:bg-accent-color/30 flex-grow" accept=".zip">
                            <button id="uploadSaZipBtn" class="btn-primary">Upload</button>
                        </div>
                        <p class="text-sm text-text-color/70">Upload a ZIP file containing your service account JSONs.</p>
                    </div>
                </div>
            </div>

            <!-- Web Terminal Section -->
            <div id="web-terminal-section" class="content-section card p-6 rounded-xl shadow-md hidden">
                <h2 class="text-2xl font-bold mb-4 text-primary-color flex items-center"><i class="fas fa-terminal mr-3"></i> Web Terminal</h2>
                <div class="flex flex-wrap gap-2 mb-4">
                    <input type="text" id="terminal-command-input" class="input-field flex-grow" placeholder="Enter command...">
                    <button id="executeTerminalBtn" class="btn-primary">Execute</button>
                    <button id="stopTerminalBtn" class="btn-danger hidden">Stop Process</button>
                    <button id="clearTerminalOutputBtn" class="btn-secondary">Clear</button>
                    <button id="downloadTerminalLogBtn" class="btn-secondary"><i class="fas fa-download mr-2"></i> Log</button>
                </div>
                <div class="relative">
                     <div id="terminal-spinner" class="spinner-overlay hidden">
                        <div class="spinner"></div>
                        <p id="terminal-spinner-text" class="spinner-text">Executing...</p>
                    </div>
                    <pre id="terminalOutput" class="output-area"></pre>
                </div>
            </div>
            
            <!-- Recent Commands Section -->
            <div id="recent-commands-section" class="content-section card p-6 rounded-xl shadow-md hidden">
                 <h2 class="text-2xl font-bold mb-4 text-primary-color flex items-center"><i class="fas fa-history mr-3"></i> Recent Commands</h2>
                 <div id="recent-commands-content" class="space-y-4"></div>
            </div>

        </section>
    </main>

    <!-- Confirmation Modal for Terminal Process -->
    <div id="terminalConfirmModal" class="modal hidden">
        <div class="modal-content card rounded-xl p-8 shadow-2xl">
            <h2 class="text-2xl font-bold mb-4 text-primary-color">Process Running</h2>
            <p class="text-text-color mb-6">A command is currently running. Do you want to stop it and start a new one?</p>
            <div class="flex justify-end space-x-4">
                <button id="confirmStopAndStartBtn" class="btn-danger"><i class="fas fa-stop mr-2"></i> Stop and Start</button>
                <button id="cancelStopAndStartBtn" class="btn-secondary"><i class="fas fa-times-circle mr-2"></i> Cancel</button>
            </div>
        </div>
    </div>
    
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
